<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Axrest : " />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Luke Mallon (Nalum)</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/Nalum/AxREST">View on GitHub</a>
          <a id="back_banner" href="http://www.lukemallon.com">Back</a>

          <h1 id="project_title">Luke Mallon (Nalum)</h1>
          <h2 id="project_tagline">Software Engineer</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/Nalum/AxREST/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/Nalum/AxREST/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>AxREST</h1>

<p>A simple RESTful service to maintain a database table of users.</p>

<h2>Requirements</h2>

<ul>
<li>  PHP v5.3.1+</li>
<li>  MySQL v5.1+</li>
</ul><h3>Libraries</h3>

<ul>
<li>  <a href="https://github.com/peej/tonic/tree/v3.1">Tonic v3.1+</a> for the RESTful service.</li>
<li>  <a href="http://phpspec.net">phpspec2</a> for the unit testing.</li>
</ul><h2>How To</h2>

<h3>Local Set-up</h3>

<p>I am using Composer to get all required libraries for the system.</p>

<p>To set up run the following commands in the project root folder: (assumption of running Linux OS)</p>

<pre><code>curl http://getcomposer.org/installer | php
php composer.phar install --dev
</code></pre>

<h3>MySQL Table</h3>

<p>A user is comprised of the following fields:</p>

<ul>
<li>  <code>name</code> This is a string limited to 150 characters.</li>
<li>  <code>email</code> This is a string limited to 255 characters. The email address is validated using PHP's <code>filter_var</code> function with the flag <code>FILTER_VALIDATE_EMAIL</code>.</li>
<li>  <code>password</code> This is a string and must be at least 3 characters long. It is then hashed using SHA256.</li>
<li>  <code>dateOfBirth</code> This is a string and must be in the format of <code>yyyy-mm-dd</code> e.g. <code>1975-03-24</code>. This field is not required and can be left out of the <strong>PUT</strong> request.</li>
</ul><p>The email address is the Primary Key and so must be Unique.</p>

<p>The following SQL will add the table to your database.</p>

<pre><code>CREATE TABLE IF NOT EXISTS `user` (
    `name` varchar(150) COLLATE utf8_bin NOT NULL,
    `email` varchar(255) COLLATE utf8_bin NOT NULL,
    `password` varchar(64) COLLATE utf8_bin NOT NULL,
    `dateOfBirth` date DEFAULT NULL,
    PRIMARY KEY (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin;
</code></pre>

<p>To connect to your database edit the file <code>./config.php</code>:</p>

<pre><code>// Get the Database details from the Cloud Service.
$services_json = json_decode(getenv("VCAP_SERVICES"),true);
$mysql_config = $services_json["mysql-5.1"][0]["credentials"];

define('PDO_CONN_STRING', 'mysql:host=' . $mysql_config["hostname"] . ';port=' . $mysql_config["port"] . ';dbname=' . $mysql_config["name"] . ';');
define('PDO_CONN_USER', $mysql_config["username"]);
define('PDO_CONN_PASS', $mysql_config["password"]);
</code></pre>

<p>If you are using the AppFrog Cloud hosting you make sure you are using the correct credentials set. Otherwise change the <code>PDO_*</code> constants to suit your connection details.</p>

<h3>Unit Testing</h3>

<p>You will need to set up a database, with the user table above, that the service can be run against. Once you have that done update the connection details in <code>/spec/config.php</code></p>

<p>To run the unit tests, run the following command in the root folder of the project:</p>

<pre><code>bin/phpspec run
</code></pre>

<h3>Use Service</h3>

<h4>PUT</h4>

<p>We use <strong>PUT</strong> to create a new user in the database. Requests for this are sent to <code>/</code></p>

<p><strong>Example Request</strong>:</p>

<p>URL:</p>

<pre><code>/
</code></pre>

<p>Headers:</p>

<pre><code>Content-Type: application/json
</code></pre>

<p>Raw Data:</p>

<pre><code>{
    "name"          : "Test User",
    "email"         : "test@user.com",
    "password"      : "asdqwe"
}
</code></pre>

<p><strong>Example Response</strong>:</p>

<p>Headers:</p>

<pre><code>Content-Type: application/json
Location: /test@user.com
</code></pre>

<p>Body:</p>

<pre><code>{
    "message": "User successfully created."
}
</code></pre>

<h4>GET</h4>

<p>There are two calls to <strong>GET</strong>:</p>

<ol>
<li>
<p>The first is <code>/</code>, this will return an object containing a message and an array containing all users within the database.</p>

<p><strong>Example Request</strong>:</p>

<p>URL:</p>

<pre><code>/
</code></pre>

<p><strong>Example Response</strong>:</p>

<p>Headers:</p>

<pre><code>Content-Type: application/json
</code></pre>

<p>Body:</p>

<pre><code>{
    "message": "Success.",
    "users": [{
        "name": "Test User",
        "email": "test@user.com",
        "password": "501bb865d4a92532cfebb65ee059e4889363eeb28a22ca6fb82165bb17432724",
        "dateOfBirth": null
    }, {
        "name": "Test User 2",
        "email": "test@user2.com",
        "password": "074519e2ef816d6c5acc77af06206722301b5109ddeef9d2bac3f30ff7e8d7b3",
        "dateOfBirth": null
    }]
}
</code></pre>
</li>
<li>
<p>The second is <code>/:identity</code>, where <code>:identity</code> is the email address of the user you are looking for.</p>

<p>This will return an object with a message and an object containing the user.</p>

<p><strong>Example Request</strong>:</p>

<p>URL:</p>

<pre><code>/test@user.com
</code></pre>

<p><strong>Example Response</strong>:</p>

<p>Headers:</p>

<pre><code>Content-Type: application/json
</code></pre>

<p>Body:</p>

<pre><code>{
    "message"   : "Success.",
    "user"      : {
        "name"          : "Test User",
        "email"         : "test@user.com",
        "password"      : "05f4a1dd829dcf0f11617780634a22dbde6ad638cc2ee943ef9c258f1b1c4058",
        "dateOfBirth"   : null
    }
}
</code></pre>
</li>
</ol><h4>POST</h4>

<p>We use <strong>POST</strong> to update an existing user. This is done by specifying the <code>:identity</code> that we want to update and posting data.</p>

<p><strong>Example Request</strong>:</p>

<p>URL:</p>

<pre><code>/test@user2.com
</code></pre>

<p>Headers:</p>

<pre><code>Content-Type: application/json
</code></pre>

<p>Raw Data:</p>

<pre><code>{
    "dateOfBirth"   : "1975-03-24"
}
</code></pre>

<p><strong>Example Response</strong>:</p>

<p>Headers:</p>

<pre><code>Content-Type: application/json
Location: /test@user.com
</code></pre>

<p>Body:</p>

<pre><code>{
    "message": "The user has been successfully updated."
}
</code></pre>

<h4>DELETE</h4>

<p>When we want to delete a user from the table we use the <strong>DELETE</strong> method. As with <strong>POST</strong> we specify the <code>:identity</code> of the user to be deleted.</p>

<p><strong>Example Request</strong>:</p>

<p>URL:</p>

<pre><code>/test@user.com
</code></pre>

<p><strong>Example Response</strong>:</p>

<p>Headers:</p>

<pre><code>Content-Type: application/json
</code></pre>

<p>Body:</p>

<pre><code>{
    "message": "The user has been successfully deleted."
}
</code></pre>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Axrest maintained by <a href="https://github.com/Nalum">Nalum</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
